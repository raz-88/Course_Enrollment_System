<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Course Announcements</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<style>
/* ================= BASE ================= */
body{margin:0;font-family:system-ui;background:#f5f7fb;color:#111}
.container{max-width:1200px;margin:auto;padding:16px}

/* ================= HEADER (INDEX STYLE) ================= */
.site-header{background:#1b5e20;color:#fff;padding:12px 0}
.header-inner{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap
}
.logo{font-size:1.3rem;font-weight:700}
.nav-links a{
  color:#e8f5e9;
  text-decoration:none;
  margin-left:10px;
  font-size:.9rem
}

/* ================= PAGE TITLE ================= */
.page-title{
  margin-top:16px;
  background:#fff;
  border-radius:16px;
  padding:18px;
  box-shadow:0 2px 8px rgba(0,0,0,.08)
}
.page-title h2{margin:0}
.page-title p{color:#4b5563;font-size:.95rem}

/* ================= ANNOUNCEMENT CARD ================= */
.announcement{
  background:#fff;
  border-radius:16px;
  padding:18px;
  margin-top:16px;
  box-shadow:0 2px 10px rgba(15,23,42,.08)
}
.announcement h3{
  margin:0;
  font-size:1.05rem;
  color:#111827
}
.announcement p{
  margin:6px 0 0;
  color:#374151;
  font-size:.95rem
}
.meta{
  font-size:.8rem;
  color:#6b7280;
  margin-top:8px
}

/* ================= EMPTY ================= */
.empty{
  margin-top:20px;
  color:#6b7280;
  font-size:.95rem
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header class="site-header">
  <div class="container header-inner">
    <div class="logo">Learning Engagement Portal</div>
    <nav class="nav-links">
      <a href="../index.html">Home</a>
      <a href="student-my-enrollments.html">My Enrollments</a>
    </nav>
  </div>
</header>

<div class="container">

<!-- ================= TITLE ================= -->
<div class="page-title">
  <h2 id="courseName">Announcements</h2>
  <p id="courseDesc"></p>
</div>

<!-- ================= ANNOUNCEMENTS ================= -->
<div id="announcementList"></div>

</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig={
  apiKey:"AIzaSyBjcNmWxI91atAcnv1ALZM4723Cer6OFGo",
  authDomain:"student-enrollment-39c2f.firebaseapp.com",
  databaseURL:"https://student-enrollment-39c2f-default-rtdb.firebaseio.com",
  projectId:"student-enrollment-39c2f",
  storageBucket:"student-enrollment-39c2f.firebasestorage.app",
  messagingSenderId:"810600465736",
  appId:"1:810600465736:web:953640e6f15a530ee25f7d"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database(),auth=firebase.auth();

/* ================= GLOBAL ================= */
const courseId=new URLSearchParams(location.search).get("courseId");

/* ================= AUTH ================= */
auth.onAuthStateChanged(async user=>{
  if(!user) return location.href="../auth.html";
  loadCourse();
  loadAnnouncements();
});

/* ================= COURSE ================= */
async function loadCourse(){
  const snap=await db.ref("courses/"+courseId).get();
  if(!snap.exists()) return;
  courseName.textContent=snap.val().name+" â€“ Announcements";
  courseDesc.textContent=snap.val().description||"";
}

/* ================= ANNOUNCEMENTS ================= */
function loadAnnouncements(){
  const el=announcementList;
  el.innerHTML="";

  db.ref("announcements/"+courseId)
    .orderByChild("time")
    .on("value",snap=>{
      if(!snap.exists()){
        el.innerHTML="<p class='empty'>No announcements yet.</p>";
        return;
      }

      const items=[];
      snap.forEach(a=>items.push(a.val()));
      items.reverse(); // latest first

      el.innerHTML="";
      items.forEach(a=>{
        el.innerHTML+=`
          <div class="announcement">
            <h3>${a.title}</h3>
            <p>${a.message}</p>
            <div class="meta">
              Posted on ${new Date(a.time).toLocaleString()}
            </div>
          </div>
        `;
      });
    });
}
</script>

</body>
</html>
